# Life Simulation Romance Game - Development Documentation

## Project Vision

A long-term 2D life simulation + romance game built with Flutter, designed with **Clean Architecture + DDD** principles.

### Core Philosophy

- **Separation of Concerns**: Game engine (code) vs. game content (narrative data)
- **Domain-Driven Design**: Business logic independent of infrastructure
- **Narrative-First**: Enable non-technical writers to create scenarios using STAR format
- **No Big Ball of Mud**: Strict architectural boundaries prevent technical debt

---

## Quick Start

### Project Status
- **Current Phase**: Phase 0 - Architecture Design ‚úÖ Complete
- **Next Phase**: Phase 1 - Domain Layer Implementation

### Documentation Structure

```
docs/
‚îú‚îÄ‚îÄ 01_game_mechanics.md          # ÂÆåÊï¥ÈÅäÊà≤Ê©üÂà∂ÂÆöÁæ©
‚îú‚îÄ‚îÄ 02_domain_model.md            # Domain Layer Ë®≠Ë®à
‚îú‚îÄ‚îÄ 03_application_layer.md       # Use Cases ÂÆöÁæ©
‚îú‚îÄ‚îÄ 04_infrastructure_layer.md    # ÊåÅ‰πÖÂåñËàáË≥áÊñôËºâÂÖ•
‚îú‚îÄ‚îÄ 05_narrative_system.md        # STAR Ê†ºÂºèËàáÂäáÊú¨Ë¶èÁØÑ
‚îú‚îÄ‚îÄ 06_development_roadmap.md     # ÈñãÁôºË∑ØÁ∑öÂúñ
‚îî‚îÄ‚îÄ 07_collaboration_workflow.md  # ÂúòÈöäÂçî‰ΩúÊµÅÁ®ã
```

---

## Core Concepts

### Game Loop
```
Áé©ÂÆ∂Ëµ∑Â∫ä ‚Üí ÈÅ∏ÊìáÂ†¥ÊôØ ‚Üí Êé¢Á¥¢‰∫íÂãïÈªû ‚Üí Ëß∏Áôº‰∫ã‰ª∂ 
‚Üí ÂÅöÂá∫ÈÅ∏Êìá ‚Üí ÂΩ±ÈüøÊï∏ÂÄº/Èóú‰øÇ ‚Üí ÊôÇÈñìÊé®ÈÄ≤ ‚Üí Âæ™Áí∞
‚Üí ÈÄ±Êú´ÁâπÊÆä‰∫ã‰ª∂ ‚Üí Â≠£ÁØÄËΩâÊèõ‰∫ã‰ª∂
```

### Time Progression
- **Daily**: 4 periods (morning ‚Üí afternoon ‚Üí evening ‚Üí night)
- **Weekly**: 7 days (Monday-Sunday), week counter increments
- **Seasonal**: Event-triggered transitions (Spring ‚Üí Summer ‚Üí Autumn ‚Üí Winter)

### Location Hierarchy
```
Root Location (e.g. Home)
‚îú‚îÄ Sub-location (Kitchen)
‚îÇ  ‚îú‚îÄ Interaction Point (Stove)
‚îÇ  ‚îî‚îÄ Interaction Point (Fridge)
‚îî‚îÄ Sub-location (Bedroom)
   ‚îú‚îÄ Interaction Point (Bed)
   ‚îî‚îÄ Interaction Point (Desk)
```

### Relationship Mechanics
- **Affection**: Built through positive interactions, romance routes
- **Domination**: Built through leverage items/events, control routes
  - **YAML-driven**: Writers freely define domination gain
  - Example: Photo item +20, Video event +30, Blackmail +50
  - Flexible balancing without code changes
- **Corruption**: Player stat affecting available relationship options
  - Low: Romance-focused gameplay
  - High: Domination routes unlock

### Key Features
- **Interactive Exploration**: Click objects in scenes to discover events
- **Relationship Building**: Multiple romance routes with affection & domination mechanics
- **Stat Management**: 5 core attributes (stamina, charm, intelligence, corruption, cleanliness)
- **Seasonal Events**: Spring/Summer/Autumn/Winter cycle affects available scenarios
- **Weekly Schedule**: 7-day cycle with weekday-specific events
- **Hierarchical Locations**: Nested interaction points (home > kitchen > stove)
- **Dynamic Dialogue**: Conversations change based on interaction count
- **Multiple Endings**: Non-exclusive endings for each character

---

## Technology Stack

### Core
- **Framework**: Flutter 3.x
- **Language**: Dart 3.x
- **State Management**: Riverpod 2.x

### Architecture
- **Pattern**: Clean Architecture + DDD
- **Testing**: >80% domain layer coverage target

### Persistence
- **Local Storage**: shared_preferences
- **Format**: JSON with versioning

---

## Development Phases

| Phase                | Duration   | Deliverable                                                  | Status    |
| -------------------- | ---------- | ------------------------------------------------------------ | --------- |
| 0. Architecture      | -          | Complete design docs                                         | ‚úÖ Done    |
| 1. Domain Layer      | Week 1-2   | Core business logic (Stats, Time, Relationship, Interaction) | üìã Next    |
| 2. Application Layer | Week 3-4   | Use cases                                                    | ‚è≥ Planned |
| 3. Infrastructure    | Week 5-6   | Save system                                                  | ‚è≥ Planned |
| 4. Presentation MVP  | Week 7-8   | Playable demo                                                | ‚è≥ Planned |
| 5. Vertical Slice    | Week 9-10  | 1 character route                                            | ‚è≥ Planned |
| 6. Tooling           | Week 11-12 | Validation tools                                             | ‚è≥ Planned |
| 7. Expansion         | Week 13-16 | 3 characters, 8 scenes                                       | ‚è≥ Planned |
| 8. Polish            | Week 17-18 | Alpha release                                                | ‚è≥ Planned |

---

## Team Roles

### Engineer
- Define Domain Model
- Implement game engine
- Create mapping rules (narrative_rules.yaml)
- Maintain tooling

### Writer
- Create scenarios in STAR format
- Write character dialogues
- Design event branches
- No coding required

### PM
- Review narrative quality
- Define game balance
- Request new features
- Approve content

---

## Getting Started

### For Engineers
1. Read: `02_domain_model.md`
2. Setup: Run `flutter create life_sim_game`
3. Start: Implement `Stats` value object (TDD)

### For Writers
1. Read: `05_narrative_system.md`
2. See: Example scenarios in `/scenarios/examples/`
3. Write: Use STAR template

### For PMs
1. Read: `01_game_mechanics.md`
2. Review: `06_development_roadmap.md`
3. Plan: Content schedule

---

## Key Decisions Log

### Exploration System
- ‚úÖ Click-based interaction (not random encounters)
- ‚úÖ Hierarchical location structure:
  - Root locations (home, park, school)
  - Sub-locations (kitchen, bedroom)
  - Interaction points (stove, bed, desk)
- ‚úÖ No stamina cost for exploration
- ‚úÖ NPC hints unlock hidden interaction points
- ‚úÖ Interaction count persisted per interaction point
  - Tracks "Nth time clicking this specific point"
  - First interaction may differ from subsequent ones
  - Enables progression-based dialogue changes
  - Example: 7th visit to cafe counter = "regular customer"

### Time System
- ‚úÖ 4 time slots per day (morning/afternoon/evening/night)
- ‚úÖ Weekly cycle (Monday-Sunday, week counter increments)
- ‚úÖ Seasonal events (Spring/Summer/Autumn/Winter)
  - Season changes triggered by special events (not time-based)
  - Affects available scenarios and NPC behaviors
- ‚úÖ Stamina cannot go negative (forced rest at 0)
- ‚úÖ Minor events don't consume time
- ‚úÖ Major events consume time and force scene exit

### Relationship System
- ‚úÖ Multiple simultaneous romances allowed
- ‚úÖ Dual relationship values per character:
  - **Affection**: Mutual attraction (0-100)
  - **Domination**: Control/leverage (0-100)
- ‚úÖ Domination system design:
  - **Numeric value** (0-100), not item counter
  - **YAML-driven gains**: Writers set delta per item/event
  - **Flexible balancing**: Different items = different effects
  - **No code changes needed**: All in scenario files
  - Example YAML:
    ```yaml
    event_blackmail:
      effects:
        - type: modify_domination
          character: alice
          delta: 30
    ```
- ‚úÖ Leverage items enable domination routes
  - Items obtained through specific events
  - Required to unlock certain character interactions
- ‚úÖ Corruption stat affects available relationship options
  - Characters have corruption range requirements
  - Low corruption: Romance routes only
  - High corruption: Domination routes available
- ‚úÖ Jealousy mechanics between characters (Phase 2)

### Ending System
- ‚úÖ Multiple non-exclusive endings
- ‚úÖ Player triggers endings manually
- ‚úÖ No game over condition
- ‚úÖ Routes lock individually after ending

---

## Contact & Resources

- **Documentation**: See `/docs` folder
- **Examples**: See `/scenarios/examples` folder
- **Architecture Diagrams**: See `02_domain_model.md`

---

## Domain Design

```mermaid
classDiagram
    %% Aggregate Roots
    class GameState {
        <<Aggregate Root>>
        +Player player
        +PlayerState playerState
        +GameTime time
        +Season season
        +String currentLocationId
        +InteractionHistory interactionHistory
        +advanceTime() GameState
        +changeSeason(Season) GameState
        +moveTo(String) GameState
        +recordInteraction(String, String) GameState
        +getInteractionCount(String) int
        +modifyStat(String, int) GameState
        +modifyAffection(String, int) GameState
        +modifyDomination(String, int) GameState
    }

    class Player {
        <<Entity>>
        +String id
        +String name
        +Stats stats
        +Relationships relationships
        +Map~String,dynamic~ flags
        +modifyStat(String, int) Player
        +modifyAffection(String, int) Player
        +modifyDomination(String, int) Player
        +setFlag(String, dynamic) Player
    }

    %% Value Objects
    class GameTime {
        <<Value Object>>
        +int week
        +Weekday weekday
        +TimeOfDay period
        +advance() GameTime
        +advanceToNextDay() GameTime
        +isWeekend() bool
        +isWorkday() bool
    }

    class Stats {
        <<Value Object>>
        -Map~String,int~ _values
        +get(String) int
        +modify(String, int) Stats
        +set(String, int) Stats
        +initial()$ Stats
    }

    class Relationships {
        <<Value Object>>
        -Map~String,Relationship~ _data
        +get(String) Relationship?
        +modifyAffection(String, int) Relationships
        +modifyDomination(String, int) Relationships
        +getAll() List~Relationship~
    }

    class Relationship {
        <<Value Object>>
        +String characterId
        +int affection
        +int domination
        +modifyAffection(int) Relationship
        +modifyDomination(int) Relationship
    }

    class PlayerState {
        <<Value Object>>
        +Inventory inventory
        +String? wearing
        +Set~String~ statusEffects
        +hasItem(String) bool
        +equipItem(String) PlayerState
        +addStatus(String) PlayerState
    }

    class Inventory {
        <<Value Object>>
        -Map~String,int~ _items
        +hasItem(String) bool
        +getCount(String) int
        +addItem(String, int) Inventory
        +removeItem(String, int) Inventory
    }

    class InteractionHistory {
        <<Value Object>>
        -Map~String,InteractionRecord~ _records
        +getInteractionCount(String) int
        +hasCompletedEvent(String) bool
        +recordInteraction(String, String) InteractionHistory
    }

    class InteractionRecord {
        <<Value Object>>
        +String pointId
        +int totalInteractions
        +Set~String~ completedEvents
        +recordEvent(String) InteractionRecord
    }

    class Location {
        <<Entity>>
        +String id
        +String? parentId
        +isChildOf(String) bool
        +isRoot() bool
    }

    %% Enums
    class Season {
        <<enumeration>>
        spring
        summer
        autumn
        winter
    }

    class Weekday {
        <<enumeration>>
        monday
        tuesday
        wednesday
        thursday
        friday
        saturday
        sunday
    }

    class TimeOfDay {
        <<enumeration>>
        morning
        afternoon
        evening
        night
    }

    %% Relationships - GameState ÁÇ∫Ê†∏ÂøÉ
    GameState *-- Player : contains
    GameState *-- PlayerState : contains
    GameState *-- GameTime : contains
    GameState *-- InteractionHistory : contains
    GameState --> Season : has
    GameState --> Location : references by id

    %% Player ÂåÖÂê´ÁöÑ Value Objects
    Player *-- Stats : contains
    Player *-- Relationships : contains

    %% Relationships ÂåÖÂê´Â§öÂÄã Relationship
    Relationships *-- "0..*" Relationship : contains

    %% PlayerState ÂåÖÂê´ Inventory
    PlayerState *-- Inventory : contains

    %% InteractionHistory ÂåÖÂê´Â§öÂÄã InteractionRecord
    InteractionHistory *-- "0..*" InteractionRecord : contains

    %% GameTime ‰ΩøÁî® Enums
    GameTime --> Weekday : uses
    GameTime --> TimeOfDay : uses

    %% Location ÁöÑÁà∂Â≠êÈóú‰øÇ
    Location --> Location : parent-child

    %% Ë®ªËß£
    note for GameState "Ê†∏ÂøÉ Aggregate Root<br />ÂçîË™øÊâÄÊúâÈ†òÂüüÁâ©‰ª∂<br />Âè™Â≠ò locationId ‰∏çÂ≠òÊï¥ÂÄã Location"
    note for Location "Entity with parent-child<br />ÊîØÊè¥Â±§Á¥öÁµêÊßã (home > kitchen > stove)"
    note for Stats "ÂÆåÂÖ®ÂΩàÊÄßÁöÑ Map<br />ÂèØÊñ∞Â¢û‰ªªÊÑèÂ±¨ÊÄß<br />È†êË®≠: stamina, charm, intelligence, corruption, cleanliness"
    note for Relationship "ÈõôÊï∏ÂÄºÁ≥ªÁµ±<br />affection: Â•ΩÊÑüÂ∫¶<br />domination: ÊîØÈÖçÂ∫¶ (YAMLÈ©ÖÂãï)"
    note for InteractionHistory "Êåâ‰∫íÂãïÈªûË®òÈåÑ<br />ÊîØÊè¥„ÄåÁ¨¨NÊ¨°ÈªûÊìä„ÄçÂ∞çË©±ËÆäÂåñ<br />totalInteractions Ê∞∏‰πÖÂÑ≤Â≠ò"
    note for Season "Áç®Á´ãÊ¨Ñ‰Ωç<br />ÈÄèÈÅé‰∫ã‰ª∂ÂàáÊèõ<br />‰∏çÈö®ÊôÇÈñìËá™ÂãïËÆäÂåñ"
```